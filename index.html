<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family:sans-serif; background:#f2f2f2; margin:0; padding:8px; }
.app { max-width:360px; margin:0 auto; }

/* HEADER */
.header {
  display:flex; justify-content:space-between; align-items:center;
  background:#fff; padding:12px; border-radius:10px;
  margin-bottom:12px; box-shadow:0 1px 3px rgba(0,0,0,.08);
}
.logo { height:80px; }

.right { display:flex; flex-direction:column; align-items:flex-end; gap:6px; }

.lang-switch {
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:6px;
  font-size:13px;
}
.flag { font-size:20px; }

.actions { display:flex; gap:8px; align-items:center; }

.avatar {
  width:32px; height:32px; border-radius:50%;
}

.btn {
  padding:7px 16px; font-size:13px;
  border-radius:6px; border:1px solid #bbb;
  background:#fff; cursor:pointer;
}
.btn.edit-on { background:#ffecb3; border-color:#ff9800; }

/* CARDS */
.card {
  background:#fff; border-radius:8px; padding:8px;
  margin-bottom:8px; border:2px solid transparent;
  box-shadow:0 1px 3px rgba(0,0,0,.08);
}
.card.free { background:#e8f5e9; border-color:#4caf50; }
.card.assigned { border-color:#e53935; }
.card.unavailable { background:#eee; border-color:#9e9e9e; }

.name { font-weight:700; margin-bottom:6px; }
.row { display:flex; gap:10px; }
img.bike { width:130px; }

.info { font-size:11px; color:#555; line-height:1.6; }
.info div { margin-bottom:6px; }

.status-btn {
  margin-top:8px;
  min-height:38px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  border-radius:6px;
  border:1px solid #999;
  cursor:pointer;
}

.status-menu {
  margin-top:4px;
  border:1px solid #ccc;
  border-radius:6px;
  overflow:hidden;
}
.status-menu div {
  padding:6px;
  cursor:pointer;
}
.status-menu div:hover { background:#eee; }

.updated { font-size:11px; color:#777; margin-top:4px; }

input.date { width:100%; font-size:11px; padding:2px; }

.warn { color:#ff9800; animation:flash 1.2s infinite; }
.expired { color:#e53935; font-weight:600; }

@keyframes flash {
  0%{opacity:1} 50%{opacity:.3} 100%{opacity:1}
}
</style>
</head>

<body>

<div class="app">

<div class="header">
  <img src="Logo.png" class="logo">

  <div class="right">
    <div class="lang-switch" onclick="toggleLang()">
      <span id="langLabel"></span>
      <span id="langFlag" class="flag"></span>
    </div>

    <div class="actions">
      <img id="avatar" class="avatar">
      <button id="loginBtn" class="btn" onclick="signIn()"></button>
      <button id="logoutBtn" class="btn" onclick="signOut()"></button>
      <button id="editBtn" class="btn" onclick="toggleEdit()">Edit</button>
    </div>
  </div>
</div>

<div id="bikes"></div>

</div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"AIzaSyCqJ-LqV_hn06MhfweOTJGIDmIt5bIq2JI",
  authDomain:"baan-namsai-bikes.firebaseapp.com",
  projectId:"baan-namsai-bikes"
});
const auth = firebase.auth();
const db = firebase.firestore();
const ADMIN_UID = "pK46rxDcvEVZEyktMvc8g2FaCoH2";

/* ================= AUTH CACHE ================= */
function getCachedUser(){
  try { return JSON.parse(localStorage.getItem("authCache")); }
  catch { return null; }
}

const avatar = document.getElementById("avatar");
const loginBtn = document.getElementById("loginBtn");
const logoutBtn = document.getElementById("logoutBtn");
const editBtn = document.getElementById("editBtn");

/* optimistic render (NO FLASH) */
const cachedUser = getCachedUser();
if(cachedUser){
  avatar.src = cachedUser.photoURL || "";
  loginBtn.style.display = "none";
  logoutBtn.style.display = "inline-block";
  editBtn.style.display = cachedUser.uid === ADMIN_UID ? "inline-block" : "none";
} else {
  avatar.style.display = "none";
  loginBtn.style.display = "inline-block";
  logoutBtn.style.display = "none";
  editBtn.style.display = "none";
}

/* authoritative sync */
auth.onAuthStateChanged(user=>{
  if(user){
    localStorage.setItem("authCache", JSON.stringify({
      uid:user.uid,
      photoURL:user.photoURL,
      displayName:user.displayName
    }));
    avatar.src = user.photoURL || "";
    avatar.style.display = user.photoURL ? "block" : "none";
    loginBtn.style.display = "none";
    logoutBtn.style.display = "inline-block";
    editBtn.style.display = user.uid === ADMIN_UID ? "inline-block" : "none";
  } else {
    localStorage.removeItem("authCache");
    avatar.style.display = "none";
    loginBtn.style.display = "inline-block";
    logoutBtn.style.display = "none";
    editBtn.style.display = "none";
  }
});

/* ================= ACTIONS ================= */
function signIn(){ auth.signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
function signOut(){ auth.signOut(); }
function toggleEdit(){}

/* (Bike logic unchanged â€“ your existing fast version continues here) */
</script>

</body>
</html>
